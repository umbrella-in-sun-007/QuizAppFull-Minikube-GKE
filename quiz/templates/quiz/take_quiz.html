{% extends "base.html" %}
{% load static %}

{% block content %}
<style>
  #questionNav .question-btn {
    min-width: 50px;
    height: 50px;
  }

  #questionNav .btn-answered {
    background-color: #198754;
    border-color: #198754;
    color: white;
  }

  #questionNav .btn-current {
    background-color: #0d6efd;
    border-color: #0d6efd;
    color: white;
  }

  #questionNav .btn-unanswered {
    background-color: #6c757d;
    border-color: #6c757d;
    color: white;
  }

  .timer-warning {
    animation: pulse 1s infinite;
  }

  @keyframes pulse {

    0%,
    100% {
      opacity: 1;
    }

    50% {
      opacity: 0.6;
    }
  }

  .nav-card {
    position: sticky;
    top: 20px;
  }

  #quizApp {
    min-height: 80vh;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.875rem;
  }

  .legend-box {
    width: 20px;
    height: 20px;
    border: 2px solid;
  }
</style>

<div class="container-fluid my-4" id="quizApp" data-attempt="{{ attempt.id }}"
  data-monitor-tab-switching="{% if monitor_tab_switching %}true{% else %}false{% endif %}"
  data-max-tab-switches="{{ max_tab_switches|default:0 }}"
  data-auto-submit-on-violations="{% if auto_submit_on_violations %}true{% else %}false{% endif %}"
  data-enable-fullscreen="{% if enable_fullscreen %}true{% else %}false{% endif %}"
  data-disable-right-click="{% if disable_right_click %}true{% else %}false{% endif %}"
  data-disable-copy-paste="{% if disable_copy_paste %}true{% else %}false{% endif %}"
  data-prevent-browser-back="{% if prevent_browser_back %}true{% else %}false{% endif %}"
  data-questions-url="{% url 'api_attempt_questions' attempt.id %}"
  data-status-url="{% url 'api_attempt_status' attempt.id %}"
  data-question-base-url="{% url 'api_attempt_question' attempt.id 0 %}"
  data-answer-base-url="{% url 'api_save_answer' attempt.id 0 %}"
  data-finalize-url="{% url 'api_finalize_attempt' attempt.id %}">

  <div class="row g-4">
    <div class="col-lg-3">
      <div class="card nav-card">
        <div class="card-header bg-primary text-white">
          <div class="d-flex justify-content-between align-items-center">
            <span>Questions</span>
            <div class="d-flex gap-2 align-items-center">
              {% if monitor_tab_switching %}
              <span class="badge bg-warning text-dark d-none" id="warningBadge" title="Warnings issued">
                <span id="warningCount">0</span>/{{ max_tab_switches }}
              </span>
              {% endif %}
              <span class="badge bg-dark" id="timer">--:--</span>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="row row-cols-4 g-2" id="questionNav"></div>
          <hr class="my-3">
          <div class="d-flex flex-column gap-2">
            <div class="legend-item">
              <div class="legend-box bg-primary" style="border-color: #0d6efd;"></div>
              <span>Current</span>
            </div>
            <div class="legend-item">
              <div class="legend-box bg-success" style="border-color: #198754;"></div>
              <span>Answered</span>
            </div>
            <div class="legend-item">
              <div class="legend-box bg-secondary" style="border-color: #6c757d;"></div>
              <span>Not Answered</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-9">
      <div id="questionPanel" class="mb-3">
        <div class="alert alert-info">Loading questions...</div>
      </div>
      <hr class="my-4">
      <div class="d-flex justify-content-between align-items-center">
        <button class="btn btn-secondary" id="prevBtn" disabled>Previous</button>
        <div class="d-flex gap-2">
          <button class="btn btn-warning" id="clearBtn" disabled>Clear</button>
          <button class="btn btn-primary" id="nextBtn" disabled>Next</button>
          <button class="btn btn-success d-none" id="finalizeBtn">Submit Quiz</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="{% static 'quiz/js/take_quiz.js' %}"></script>
{% endblock %}