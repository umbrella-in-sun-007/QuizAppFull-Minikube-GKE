{% extends "base.html" %}
{% load static %}

{% block content %}
<style>
  #questionNav .question-btn {
    min-width: 50px;
    height: 50px;
  }

  #questionNav .btn-answered {
    background-color: #198754;
    border-color: #198754;
    color: white;
  }

  #questionNav .btn-current {
    background-color: #0d6efd;
    border-color: #0d6efd;
    color: white;
  }

  #questionNav .btn-unanswered {
    background-color: #6c757d;
    border-color: #6c757d;
    color: white;
  }

  .timer-warning {
    animation: pulse 1s infinite;
  }

  @keyframes pulse {

    0%,
    100% {
      opacity: 1;
    }

    50% {
      opacity: 0.6;
    }
  }

  .nav-card {
    position: sticky;
    top: 20px;
  }

  #quizApp {
    min-height: 80vh;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.875rem;
  }

  .option-card:focus-within {
    border-color: #0d6efd;
    box-shadow: 0 0 0 4px rgba(13, 110, 253, 0.25);
  }

  .legend-box {
    width: 20px;
    height: 20px;
    border: 2px solid;
  }

  /* Option Card Styling */
  /* Option Card Styling - Dark Mode Optimized */
  .option-card {
    cursor: pointer;
    border: 1px solid #3a3a3a;
    background-color: #2a2a2a;
    color: #e0e0e0;
    position: relative;
    /* Needed for stretched-link */
  }

  .option-card:hover {
    background-color: #333333;
    border-color: #6c757d;
  }

  .option-card.selected {
    border-color: #3498db;
    background-color: rgba(52, 152, 219, 0.15);
    border-width: 2px;
  }

  /* Adjust padding to account for border width change to prevent layout shift */
  .option-card:not(.selected) {
    border-width: 1px;
    margin-bottom: 1rem;
    /* Ensure spacing */
  }

  .option-card.selected {
    margin-bottom: 1rem;
  }

  .option-card .form-check-input {
    /* Reset any bootstrap negative margins if they persist */
    margin-left: 0;
    flex-shrink: 0;
    /* Prevent input from shrinking */
    width: 1.25em;
    height: 1.25em;
    background-color: #1a1a1a;
    border-color: #3a3a3a;
  }

  .option-card .form-check-input:checked {
    background-color: #3498db;
    border-color: #3498db;
  }

  .option-card label {
    cursor: pointer;
    font-size: 1rem;
    color: #e0e0e0;
    margin-bottom: 0;
    /* Fix alignment */
  }

  .option-card.selected label {
    color: #3498db;
    font-weight: 500;
  }

  .option-card:focus-within {
    border-color: #3498db;
    box-shadow: 0 0 0 0.25rem rgba(52, 152, 219, 0.25);
  }
</style>

<div class="container-fluid my-4" id="quizApp" data-attempt="{{ attempt.id }}"
  data-monitor-tab-switching="{% if monitor_tab_switching %}true{% else %}false{% endif %}"
  data-max-tab-switches="{{ max_tab_switches|default:0 }}"
  data-auto-submit-on-violations="{% if auto_submit_on_violations %}true{% else %}false{% endif %}"
  data-enable-fullscreen="{% if enable_fullscreen %}true{% else %}false{% endif %}"
  data-disable-right-click="{% if disable_right_click %}true{% else %}false{% endif %}"
  data-disable-copy-paste="{% if disable_copy_paste %}true{% else %}false{% endif %}"
  data-prevent-browser-back="{% if prevent_browser_back %}true{% else %}false{% endif %}"
  data-questions-url="{% url 'api_attempt_questions' attempt.id %}"
  data-status-url="{% url 'api_attempt_status' attempt.id %}"
  data-question-base-url="{% url 'api_attempt_question' attempt.id 0 %}"
  data-answer-base-url="{% url 'api_save_answer' attempt.id 0 %}"
  data-finalize-url="{% url 'api_finalize_attempt' attempt.id %}">

  <div class="row g-4">
    <div class="col-lg-3">
      <div class="card nav-card">
        <div class="card-header bg-primary text-white">
          <div class="d-flex justify-content-between align-items-center">
            <span>Questions</span>
            <div class="d-flex gap-2 align-items-center">
              {% if monitor_tab_switching %}
              <span class="badge bg-warning text-dark d-none" id="warningBadge" title="Warnings issued">
                <span id="warningCount">0</span>/{{ max_tab_switches }}
              </span>
              {% endif %}
              <span class="badge bg-dark" id="timer">--:--</span>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="row row-cols-4 g-2" id="questionNav"></div>
          <hr class="my-3">
          <div class="d-flex flex-column gap-2">
            <div class="legend-item">
              <div class="legend-box bg-primary" style="border-color: #0d6efd;"></div>
              <span>Current</span>
            </div>
            <div class="legend-item">
              <div class="legend-box bg-success" style="border-color: #198754;"></div>
              <span>Answered</span>
            </div>
            <div class="legend-item">
              <div class="legend-box bg-secondary" style="border-color: #6c757d;"></div>
              <span>Not Answered</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-9">
      <div id="questionPanel" class="mb-3">
        <div class="alert alert-info">Loading questions...</div>
      </div>
      <hr class="my-4">
      <div class="d-flex justify-content-between align-items-center">
        <button class="btn btn-secondary" id="prevBtn" disabled>Previous</button>
        <div class="d-flex gap-2">
          <button class="btn btn-warning" id="clearBtn" disabled>Clear</button>
          <button class="btn btn-primary" id="nextBtn" disabled>Next</button>
          <button class="btn btn-success d-none" id="finalizeBtn">Submit Quiz</button>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- Warning Modal -->
<div class="modal fade" id="warningModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title">⚠️ Warning</h5>
      </div>
      <div class="modal-body">
        <p id="warningMessage" class="fs-5"></p>
        <p class="text-muted small mb-0" id="warningFooter">Remaining warnings: <span id="remainingWarnings"
            class="fw-bold"></span></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary w-100" id="ackWarningBtn">I Understand & Resume Quiz</button>
      </div>
    </div>
  </div>
</div>

<script type="module" src="{% static 'quiz/js/modules/main.js' %}"></script>
{% endblock %}